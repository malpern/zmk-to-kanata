============================= test session starts ==============================
platform darwin -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0
rootdir: /Volumes/FlashGordon/Dropbox/code/nicktokatana
configfile: pyproject.toml
testpaths: tests
collected 117 items

tests/dts/test_ast.py .....                                              [  4%]
tests/dts/test_end_to_end.py ......                                      [  9%]
tests/dts/test_extractor.py .....                                        [ 13%]
tests/dts/test_integration.py .....                                      [ 17%]
tests/dts/test_parser.py .............                                   [ 29%]
tests/dts/test_performance.py ....                                       [ 32%]
tests/dts/test_preprocessor.py ...........                               [ 41%]
tests/test_dts_parser.py ..............                                  [ 53%]
tests/test_dts_preprocessor.py ...                                       [ 56%]
tests/test_hold_tap_behavior.py ......                                   [ 61%]
tests/test_holdtap_transformer.py ..........                             [ 70%]
tests/test_kanata_converter.py .....                                     [ 74%]
tests/test_keymap_model.py ..........                                    [ 82%]
tests/test_main.py .......                                               [ 88%]
tests/test_regression_real_world.py ssFFFF                               [ 94%]
tests/test_unicode_behavior.py .......                                   [100%]

=================================== FAILURES ===================================
_____ test_no_unsupported_features[tests/fixtures/real_world/card.keymap] ______

zmk_file = 'tests/fixtures/real_world/card.keymap'
generated_outputs = {'tests/fixtures/real_world/card.keymap': PosixPath('/private/var/folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-o.../folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-of-malpern/pytest-151/kanata_regression0/piano.keymap.out.kanata')}

    @pytest.mark.parametrize("zmk_file", list(zmk_files()))
    def test_no_unsupported_features(zmk_file, generated_outputs):
        """
        Fail if any line in the generated output contains an unsupported feature or error.
        """
        out_file = generated_outputs[zmk_file]
        with open(out_file) as f:
            for i, line in enumerate(f, 1):
                if (
                    line.strip().startswith("; unsupported:")
                    or line.strip().startswith("; <err:")
                ):
>                   pytest.fail(
                        f"{out_file}:{i} contains unsupported feature: "
                        f"{line.strip()}"
                    )
E                   Failed: /private/var/folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-of-malpern/pytest-151/kanata_regression0/card.keymap.out.kanata:77 contains unsupported feature: ; unsupported: unknown binding: &alpha2macro

tests/test_regression_real_world.py:94: Failed
_____ test_no_unsupported_features[tests/fixtures/real_world/piano.keymap] _____

zmk_file = 'tests/fixtures/real_world/piano.keymap'
generated_outputs = {'tests/fixtures/real_world/card.keymap': PosixPath('/private/var/folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-o.../folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-of-malpern/pytest-151/kanata_regression0/piano.keymap.out.kanata')}

    @pytest.mark.parametrize("zmk_file", list(zmk_files()))
    def test_no_unsupported_features(zmk_file, generated_outputs):
        """
        Fail if any line in the generated output contains an unsupported feature or error.
        """
        out_file = generated_outputs[zmk_file]
        with open(out_file) as f:
            for i, line in enumerate(f, 1):
                if (
                    line.strip().startswith("; unsupported:")
                    or line.strip().startswith("; <err:")
                ):
>                   pytest.fail(
                        f"{out_file}:{i} contains unsupported feature: "
                        f"{line.strip()}"
                    )
E                   Failed: /private/var/folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-of-malpern/pytest-151/kanata_regression0/piano.keymap.out.kanata:76 contains unsupported feature: ; unsupported: unknown binding: &caps_alpha2macro

tests/test_regression_real_world.py:94: Failed
_ test_no_long_lines_in_kanata_outputs[tests/fixtures/real_world/card.keymap] __

zmk_file = 'tests/fixtures/real_world/card.keymap'
generated_outputs = {'tests/fixtures/real_world/card.keymap': PosixPath('/private/var/folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-o.../folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-of-malpern/pytest-151/kanata_regression0/piano.keymap.out.kanata')}

    @pytest.mark.parametrize("zmk_file", list(zmk_files()))
    def test_no_long_lines_in_kanata_outputs(zmk_file, generated_outputs):
        """
        Fail if any line in the generated output exceeds 79 characters.
        """
        out_file = generated_outputs[zmk_file]
        with open(out_file) as f:
            for i, line in enumerate(f, 1):
>               assert (
                    len(line.rstrip("\n")) <= 79
                ), f"{out_file}:{i} line too long"
E               AssertionError: /private/var/folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-of-malpern/pytest-151/kanata_regression0/card.keymap.out.kanata:248 line too long
E               assert 81 <= 79
E                +  where 81 = len('  LC(LG(LS(N4))) ; tap only (ZMK: &td LC(LG(LS(N4)))) ; unsupported: missing h...')
E                +    where '  LC(LG(LS(N4))) ; tap only (ZMK: &td LC(LG(LS(N4)))) ; unsupported: missing h...' = <built-in method rstrip of str object at 0x1060418f0>('\n')
E                +      where <built-in method rstrip of str object at 0x1060418f0> = '  LC(LG(LS(N4))) ; tap only (ZMK: &td LC(LG(LS(N4)))) ; unsupported: missing h...\n'.rstrip

tests/test_regression_real_world.py:108: AssertionError
_ test_no_long_lines_in_kanata_outputs[tests/fixtures/real_world/piano.keymap] _

zmk_file = 'tests/fixtures/real_world/piano.keymap'
generated_outputs = {'tests/fixtures/real_world/card.keymap': PosixPath('/private/var/folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-o.../folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-of-malpern/pytest-151/kanata_regression0/piano.keymap.out.kanata')}

    @pytest.mark.parametrize("zmk_file", list(zmk_files()))
    def test_no_long_lines_in_kanata_outputs(zmk_file, generated_outputs):
        """
        Fail if any line in the generated output exceeds 79 characters.
        """
        out_file = generated_outputs[zmk_file]
        with open(out_file) as f:
            for i, line in enumerate(f, 1):
>               assert (
                    len(line.rstrip("\n")) <= 79
                ), f"{out_file}:{i} line too long"
E               AssertionError: /private/var/folders/0s/42v7yl697hn0l1cdnx0vrvyr0000gn/T/pytest-of-malpern/pytest-151/kanata_regression0/piano.keymap.out.kanata:183 line too long
E               assert 81 <= 79
E                +  where 81 = len('  LC(LG(LS(N4))) ; tap only (ZMK: &td LC(LG(LS(N4)))) ; unsupported: missing h...')
E                +    where '  LC(LG(LS(N4))) ; tap only (ZMK: &td LC(LG(LS(N4)))) ; unsupported: missing h...' = <built-in method rstrip of str object at 0x106041590>('\n')
E                +      where <built-in method rstrip of str object at 0x106041590> = '  LC(LG(LS(N4))) ; tap only (ZMK: &td LC(LG(LS(N4)))) ; unsupported: missing h...\n'.rstrip

tests/test_regression_real_world.py:108: AssertionError
=========================== short test summary info ============================
FAILED tests/test_regression_real_world.py::test_no_unsupported_features[tests/fixtures/real_world/card.keymap]
FAILED tests/test_regression_real_world.py::test_no_unsupported_features[tests/fixtures/real_world/piano.keymap]
FAILED tests/test_regression_real_world.py::test_no_long_lines_in_kanata_outputs[tests/fixtures/real_world/card.keymap]
FAILED tests/test_regression_real_world.py::test_no_long_lines_in_kanata_outputs[tests/fixtures/real_world/piano.keymap]
=================== 4 failed, 111 passed, 2 skipped in 1.49s ===================
